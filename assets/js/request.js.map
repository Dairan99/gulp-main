{"version":3,"file":"request.js","sources":["request.js"],"sourcesContent":["document.addEventListener('DOMContentLoaded', () => {\n\n    function clearInput(button) {\n        const input = button.parentNode.querySelector('input');\n        input.value = '';\n        toggleClearButton(button);\n    }\n\n    function toggleClearButton(button) {\n        const input = button.parentNode.querySelector('input');\n        const clearButton = button;\n        if (input.value.length > 0) {\n            clearButton.style.display = 'block';\n        } else {\n            clearButton.style.display = 'none';\n        }\n    }\n\n    const clearInputButtons = document.querySelectorAll('.input-clear');\n    clearInputButtons.forEach(button => {\n        const input = button.parentNode.querySelector('input');\n        input.addEventListener('input', () => toggleClearButton(button));\n        toggleClearButton(button);\n        button.addEventListener('click', () => clearInput(button));\n    });\n\n\n    ;[].forEach.call(\n        document.querySelectorAll('input[type=tel]'),\n        function (input) {\n            let keyCode\n            function mask(event) {\n                event.keyCode && (keyCode = event.keyCode)\n                let pos = this.selectionStart\n                if (pos < 3) event.preventDefault()\n                let matrix = '+7 (___) ___-__-__',\n                    i = 0,\n                    def = matrix.replace(/\\D/g, ''),\n                    val = this.value.replace(/\\D/g, ''),\n                    new_value = matrix.replace(/[_\\d]/g, function (a) {\n                        return i < val.length ? val.charAt(i++) || def.charAt(i) : a\n                    })\n                i = new_value.indexOf('_')\n                if (i != -1) {\n                    i < 5 && (i = 3)\n                    new_value = new_value.slice(0, i)\n                }\n                let reg = matrix\n                    .substr(0, this.value.length)\n                    .replace(/_+/g, function (a) {\n                        return '\\\\d{1,' + a.length + '}'\n                    })\n                    .replace(/[+()]/g, '\\\\$&')\n                reg = new RegExp('^' + reg + '$')\n                if (\n                    !reg.test(this.value) ||\n                    this.value.length < 5 ||\n                    (keyCode > 47 && keyCode < 58)\n                )\n                    this.value = new_value\n                if (event.type == 'blur' && this.value.length < 5) this.value = ''\n            }\n\n            input.addEventListener('input', mask, false)\n            input.addEventListener('focus', mask, false)\n            input.addEventListener('blur', mask, false)\n            input.addEventListener('keydown', mask, false)\n        }\n    )\n\n    function GetYMCID() {\n        var match = document.cookie.match('(?:^|;)\\\\s*_ym_uid=([^;]*)');\n        return (match) ? decodeURIComponent(match[1]) : false;\n    }\n\n    const formButtons = document.querySelectorAll('button[type=\"submit\"]');\n\n    formButtons.forEach(button => {\n\n        const formObj = button.parentNode;\n        const divWrap = document.createElement('div');\n        divWrap.innerHTML =\n            `<input name=\"trafficSource\" type=\"hidden\" value=\"\">\n            <input name=\"istochnik\" type=\"hidden\" value=\"\">\n            <input name=\"clientID\" type=\"hidden\" value=\"${GetYMCID()}\">`;\n        formObj.appendChild(divWrap);\n\n        if (typeof sbjs !== 'undefined') {\n            sbjs.init(divWrap);\n            formObj.querySelector(\"input[name=trafficSource]\").value = sbjs.get.current.typ;\n            formObj.querySelector(\"input[name=istochnik]\").value = sbjs.get.current.src;\n        }\n\n        button.addEventListener('click', async function (event) {\n            event.preventDefault();\n            console.log(\"testr\");\n            const form = this.closest('form');\n            const modalOpen = form.dataset.modalOpen;\n            const popups = {\n                success: form.dataset.modalOk,\n                error: form.dataset.modalErr\n            };\n\n            const fields = {};\n            const inputs = form.querySelectorAll('input[type=\"tel\"], textarea, input[type=\"text\"]');\n            inputs.forEach(input => {\n                if (input.hasAttribute('required')) {\n                    fields[input.name] = {\n                        type: input.type,\n                        value: input.value\n                    };\n                }\n            })\n\n            const resultWrappers = {\n                success: document.querySelector(popups.success),\n                error: document.querySelector(popups.error)\n            };\n\n            if (validateInputs(fields)) {\n                await handleSubmission(this, form, resultWrappers, modalOpen);\n            } else {\n                markErrors(form);\n            }\n\n        });\n\n        const urlInputs = document.querySelectorAll(\"input[name='urlMessage'], input[name='title_url_message']\");\n        urlInputs.forEach(input => {\n            input.value = input.name === 'urlMessage' ? window.location.href : document.title;\n        });\n    });\n\n    function validateInputs(fields) {\n        let isValid = true;\n        for (let fieldName in fields) {\n            const field = fields[fieldName];\n            switch (field.type) {\n                case 'tel':\n                    const phoneNumber = field.value.replace(/\\D/g, '');\n                    if (phoneNumber.length < 11) {\n                        isValid = false;\n                    }\n                    break;\n                case 'textarea':\n                case 'text':\n                    if (!/[а-яА-ЯёЁ]/.test(field.value) || field.value.trim().length <= 2) {\n                        isValid = false;\n                    }\n                    break;\n                default:\n                    isValid = false;\n                    break;\n            }\n            if (!isValid) {\n                break;\n            }\n        }\n        return isValid;\n    }\n\n    async function handleSubmission(button, form, resultWrappers, modalOpen) {\n        const originalText = button.innerText;\n        button.innerHTML = \"Отправление\";\n        button.disabled = true;\n        try {\n            const response = await fetch(`/netcat_template/ajax/request.php`, {\n                method: 'POST',\n                body: new FormData(form)\n            });\n            const responseText = await response.text();\n            const isSuccess = response.ok;\n            openModal(isSuccess ? resultWrappers.success : resultWrappers.error, responseText, modalOpen);\n\n        } catch (error) {\n            openModal(resultWrappers.error, error.message, modalOpen);\n        } finally {\n            resetButton(button, originalText);\n        }\n    }\n\n    function openModal(wrapper, content, modalOpen) {\n        const modal = wrapper.closest('.popup');\n        modal.classList.add(modalOpen);\n        wrapper.innerHTML = content;\n    }\n\n    function resetButton(button, buttonText) {\n        button.innerText = buttonText;\n        button.disabled = false;\n    }\n\n    function validateInputs(fields) {\n        let isValid = true;\n        for (let fieldName in fields) {\n            const field = fields[fieldName];\n            switch (field.type) {\n                case 'tel':\n                    const phoneNumber = field.value.replace(/\\D/g, '');\n                    if (phoneNumber.length < 11) {\n                        isValid = false;\n                    }\n                    break;\n                case 'textarea':\n                case 'text':\n                    if (!/[а-яА-ЯёЁ]/.test(field.value) || field.value.trim().length <= 2) {\n                        isValid = false;\n                    }\n                    break;\n                default:\n                    isValid = false;\n                    break;\n            }\n            if (!isValid) {\n                break;\n            }\n        }\n        return isValid;\n    }\n\n    function markErrors(form) {\n\n        const inputs = form.querySelectorAll('input[type=\"tel\"], textarea, input[type=\"text\"]');\n\n        inputs.forEach(input => {\n            removeErrorStyle(input);\n            const errorMessage = getErrorMessage(input);\n\n            if (errorMessage) {\n                addErrorStyle(input, errorMessage,);\n                setTimeout(() => {\n                    removeErrorStyle(input);\n                }, 3000);\n            }\n\n            input.addEventListener('input', function () {\n                if (this.value) {\n                    removeErrorStyle(this);\n                }\n            });\n        });\n    }\n\n    function getErrorMessage(input) {\n\n        let message = '';\n\n        switch (input.type) {\n            case 'tel':\n                const phoneNumber = input.value.replace(/\\D/g, '');\n                if (phoneNumber.length < 11) {\n                    message = 'Введите верный номер телефона';\n                }\n                break;\n            case 'textarea':\n            case 'text':\n                if (!/[а-яА-ЯёЁ]/.test(input.value) || input.value.trim().length <= 2) {\n                    message = 'Текст должен содержать русские буквы';\n                }\n                break;\n            default:\n                message = 'Поле не заполнено';\n                break;\n        }\n\n        return message;\n    }\n\n    function addErrorStyle(input, message) {\n        input.classList.add(\"error-wrapper\");\n        input.classList.add('error');\n    }\n\n    function removeErrorStyle(input) {\n        input.classList.remove('error');\n        input.classList.remove('error-wrapper');\n    }\n\n});\n\n"],"names":["document","addEventListener","toggleClearButton","button","input","parentNode","querySelector","value","length","clearButton","style","display","openModal","wrapper","content","modalOpen","closest","classList","add","innerHTML","removeErrorStyle","remove","querySelectorAll","forEach","call","let","keyCode","mask","event","this","selectionStart","preventDefault","matrix","i","def","replace","val","new_value","a","charAt","indexOf","slice","reg","substr","RegExp","test","type","match","formObj","divWrap","createElement","cookie","decodeURIComponent","appendChild","sbjs","init","get","current","typ","src","async","console","log","form","dataset","popups","success","modalOk","error","modalErr","fields","hasAttribute","name","resultWrappers","isValid","fieldName","field","trim","handleSubmission","originalText","innerText","disabled","response","await","fetch","method","body","FormData","responseText","text","ok","message","buttonText","errorMessage","setTimeout","window","location","href","title"],"mappings":"AAAAA,SAASC,iBAAiB,mBAAoB,KAQ1C,SAASC,EAAkBC,GACvB,IAAMC,EAAQD,EAAOE,WAAWC,cAAc,OAAO,EAE5B,EAArBF,EAAMG,MAAMC,OACZC,EAAYC,MAAMC,QAAU,QAE5BF,EAAYC,MAAMC,QAAU,MAEpC,CAqKA,SAASC,EAAUC,EAASC,EAASC,GACnBF,EAAQG,QAAQ,QAAQ,EAChCC,UAAUC,IAAIH,CAAS,EAC7BF,EAAQM,UAAYL,CACxB,CAwFA,SAASM,EAAiBhB,GACtBA,EAAMa,UAAUI,OAAO,OAAO,EAC9BjB,EAAMa,UAAUI,OAAO,eAAe,CAC1C,CAlQ0BrB,SAASsB,iBAAiB,cAAc,EAChDC,QAAQpB,IACRA,EAAOE,WAAWC,cAAc,OAAO,EAC/CL,iBAAiB,QAAS,IAAMC,EAAkBC,CAAM,CAAC,EAC/DD,EAAkBC,CAAM,EACxBA,EAAOF,iBAAiB,QAAS,KArBrC,IAAoBE,GAAAA,EAqBkCA,GApB7BE,WAAWC,cAAc,OAAO,EAC/CC,MAAQ,GACdL,EAAkBC,CAAM,CAkBgC,CAAC,CAC7D,CAAC,EAGA,GAAGoB,QAAQC,KACRxB,SAASsB,iBAAiB,iBAAiB,EAC3C,SAAUlB,GACNqB,IAAIC,EACJ,SAASC,EAAKC,GACVA,EAAMF,UAAYA,EAAUE,EAAMF,SACxBG,KAAKC,eACL,GAAGF,EAAMG,eAAe,EAClCN,IAAIO,EAAS,qBACTC,EAAI,EACJC,EAAMF,EAAOG,QAAQ,MAAO,EAAE,EAC9BC,EAAMP,KAAKtB,MAAM4B,QAAQ,MAAO,EAAE,EAClCE,EAAYL,EAAOG,QAAQ,SAAU,SAAUG,GAC3C,OAAOL,EAAIG,EAAI5B,OAAS4B,EAAIG,OAAON,CAAC,EAAE,GAAKC,EAAIK,OAAON,CAAC,EAAIK,CAC/D,CAAC,EAEI,CAAC,IADVL,EAAII,EAAUG,QAAQ,GAAG,KAErBP,EAAI,IAAMA,EAAI,GACdI,EAAYA,EAAUI,MAAM,EAAGR,CAAC,GAEpCR,IAAIiB,EAAMV,EACLW,OAAO,EAAGd,KAAKtB,MAAMC,MAAM,EAC3B2B,QAAQ,MAAO,SAAUG,GACtB,MAAO,SAAWA,EAAE9B,OAAS,GACjC,CAAC,EACA2B,QAAQ,SAAU,MAAM,GAGzB,EAACO,EAFC,IAAIE,OAAO,IAAMF,EAAM,GAAG,GAEvBG,KAAKhB,KAAKtB,KAAK,GACpBsB,KAAKtB,MAAMC,OAAS,GACT,GAAVkB,GAAgBA,EAAU,MAE3BG,KAAKtB,MAAQ8B,GACC,QAAdT,EAAMkB,MAAkBjB,KAAKtB,MAAMC,OAAS,IAAGqB,KAAKtB,MAAQ,GACpE,CAEAH,EAAMH,iBAAiB,QAAS0B,EAAM,CAAA,CAAK,EAC3CvB,EAAMH,iBAAiB,QAAS0B,EAAM,CAAA,CAAK,EAC3CvB,EAAMH,iBAAiB,OAAQ0B,EAAM,CAAA,CAAK,EAC1CvB,EAAMH,iBAAiB,UAAW0B,EAAM,CAAA,CAAK,CACjD,CACJ,EAOoB3B,SAASsB,iBAAiB,uBAAuB,EAEzDC,QAAQpB,IAEhB,IARI4C,EAQEC,EAAU7C,EAAOE,WACjB4C,EAAUjD,SAASkD,cAAc,KAAK,EAC5CD,EAAQ9B;;0DAVJ4B,EAAQ/C,SAASmD,OAAOJ,MAAM,4BAA4B,EACvD,CAAA,CAAA,GAAUK,mBAAmBL,EAAM,EAAE,MAa5CC,EAAQK,YAAYJ,CAAO,EAEP,aAAhB,OAAOK,OACPA,KAAKC,KAAKN,CAAO,EACjBD,EAAQ1C,cAAc,2BAA2B,EAAEC,MAAQ+C,KAAKE,IAAIC,QAAQC,IAC5EV,EAAQ1C,cAAc,uBAAuB,EAAEC,MAAQ+C,KAAKE,IAAIC,QAAQE,KAG5ExD,EAAOF,iBAAiB,QAAS2D,eAAgBhC,GAC7CA,EAAMG,eAAe,EACrB8B,QAAQC,IAAI,OAAO,EACnB,IAAMC,EAAOlC,KAAKb,QAAQ,MAAM,EAC1BD,EAAYgD,EAAKC,QAAQjD,UACzBkD,EAAS,CACXC,QAASH,EAAKC,QAAQG,QACtBC,MAAOL,EAAKC,QAAQK,QACxB,EAEA,IAAMC,EAAS,GACAP,EAAKzC,iBAAiB,iDAAiD,EAC/EC,QAAQnB,IACPA,EAAMmE,aAAa,UAAU,IAC7BD,EAAOlE,EAAMoE,MAAQ,CACjB1B,KAAM1C,EAAM0C,KACZvC,MAAOH,EAAMG,KACjB,EAER,CAAC,EAEKkE,EAAiB,CACnBP,QAASlE,SAASM,cAAc2D,EAAOC,OAAO,EAC9CE,MAAOpE,SAASM,cAAc2D,EAAOG,KAAK,CAC9C,EAEA,IAyEgBE,IACpB7C,IAAIiD,EAAU,CAAA,EACd,IAAKjD,IAAIkD,KAAaL,EAAQ,CAC1B,IAAMM,EAAQN,EAAOK,GACrB,OAAQC,EAAM9B,MACV,IAAK,MACmB8B,EAAMrE,MAAM4B,QAAQ,MAAO,EAAE,EACjC3B,OAAS,KACrBkE,EAAU,CAAA,GAEd,MACJ,IAAK,WACL,IAAK,QACG,CAAC,aAAa7B,KAAK+B,EAAMrE,KAAK,GAAKqE,EAAMrE,MAAMsE,KAAK,EAAErE,QAAU,KAChEkE,EAAU,CAAA,GAEd,MACJ,QACIA,EAAU,CAAA,CAElB,CACA,GAAI,CAACA,EACD,KAER,CACA,OAAOA,CACX,GAnG2BJ,CAAM,EAAG,CAClBQ,IAyCc3E,EAzCG0B,KAyCKkC,EAzCCA,EA0C/BgB,EAAe5E,EAAO6E,UAC5B7E,EAAOgB,UAAY,cACnBhB,EAAO8E,SAAW,CAAA,EAClB,IACI,IAAMC,EAAWC,MAAMC,MAAM,oCAAqC,CAC9DC,OAAQ,OACRC,KAAM,IAAIC,SAASxB,CAAI,CAC3B,CAAC,EACKyB,EAAeL,MAAMD,EAASO,KAAK,EAEzC7E,EADkBsE,EAASQ,GACLjB,EAAeP,QAAUO,EAAeL,MAAOoB,EAAczE,CAAS,CAMhG,CAJE,MAAOqD,GACLxD,EAAU6D,EAAeL,MAAOA,EAAMuB,QAAS5E,CAAS,CAC5D,CAAE,SAWN,CAAqBZ,EAAQyF,KACzBzF,EAAO6E,UAAYY,EACnBzF,EAAO8E,SAAW,CAAA,CACtB,GAboB9E,EAAQ4E,CAAY,CACpC,CAzDI,MACehB,EAoGCzC,iBAAiB,iDAAiD,EAE/EC,QAAQnB,IACXgB,EAAiBhB,CAAK,EACtB,IAAMyF,GAiBWzF,IAErBqB,IAAIkE,EAAU,GAEd,OAAQvF,EAAM0C,MACV,IAAK,MACmB1C,EAAMG,MAAM4B,QAAQ,MAAO,EAAE,EACjC3B,OAAS,KACrBmF,EAAU,iCAEd,MACJ,IAAK,WACL,IAAK,QACG,CAAC,aAAa9C,KAAKzC,EAAMG,KAAK,GAAKH,EAAMG,MAAMsE,KAAK,EAAErE,QAAU,KAChEmF,EAAU,wCAEd,MACJ,QACIA,EAAU,mBAElB,CAEA,OAAOA,CACX,GAxC6CvF,CAAK,EAEtCyF,KAwCWzF,EAvCGA,GAwChBa,UAAUC,IAAI,eAAe,EACnCd,EAAMa,UAAUC,IAAI,OAAO,EAxCnB4E,WAAW,KACP1E,EAAiBhB,CAAK,CAC1B,EAAG,GAAI,GAGXA,EAAMH,iBAAiB,QAAS,WACxB4B,KAAKtB,OACLa,EAAiBS,IAAI,CAE7B,CAAC,CACL,CAAC,CAnHD,CAAC,EAEiB7B,SAASsB,iBAAiB,2DAA2D,EAC7FC,QAAQnB,IACdA,EAAMG,MAAuB,eAAfH,EAAMoE,KAAwBuB,OAAOC,SAASC,KAAOjG,SAASkG,KAChF,CAAC,CACL,CAAC,CAmJL,CAAC"}